<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>StencilForge</title>
    <style>
      body {
        font-family: "Segoe UI", sans-serif;
        margin: 0;
        padding: 24px;
        background: #f7f8fb;
        color: #1f2937;
      }
      h1 {
        margin: 0 0 16px 0;
        font-size: 20px;
      }
      .card {
        background: #ffffff;
        border: 1px solid #e5e7eb;
        border-radius: 12px;
        padding: 16px;
        box-shadow: 0 6px 24px rgba(15, 23, 42, 0.06);
      }
      label {
        display: block;
        font-size: 12px;
        font-weight: 600;
        margin-bottom: 6px;
        color: #6b7280;
      }
      textarea {
        width: 100%;
        min-height: 140px;
        border-radius: 8px;
        border: 1px solid #e5e7eb;
        padding: 10px;
        font-family: "Consolas", monospace;
        font-size: 12px;
        background: #f9fafb;
      }
      button {
        margin-top: 12px;
        background: #2563eb;
        border: none;
        color: #ffffff;
        padding: 10px 16px;
        font-weight: 600;
        border-radius: 8px;
        cursor: pointer;
      }
      button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }
      #status {
        margin-top: 12px;
        font-size: 12px;
        color: #4b5563;
        white-space: pre-line;
      }
    </style>
  </head>
  <body>
    <h1>StencilForge</h1>
    <div class="card">
      <label for="config">Config JSON</label>
      <textarea id="config">
{
  "width_mm": 60.0,
  "height_mm": 40.0,
  "thickness_mm": 1.2
}
      </textarea>
      <div style="display: flex; gap: 10px; flex-wrap: wrap;">
        <button id="generate">Generate STL</button>
        <button id="preview" type="button">Open Preview</button>
        <button id="load" type="button">Load STL</button>
      </div>
      <div id="status">Ready.</div>
    </div>
    <script src="qrc:///qtwebchannel/qwebchannel.js"></script>
    <script>
      const status = document.getElementById("status");
      const button = document.getElementById("generate");
      const previewButton = document.getElementById("preview");
      const loadButton = document.getElementById("load");
      const config = document.getElementById("config");
      let backend = null;

      function setStatus(message) {
        status.textContent = message;
      }

      if (window.qt && window.QWebChannel) {
        new QWebChannel(qt.webChannelTransport, (channel) => {
          backend = channel.objects.backend;
          backend.log.connect((message) => setStatus(message));
          backend.error.connect((message) => setStatus(message));
          backend.stlGenerated.connect((path) => setStatus(`Generated: ${path}`));
        });
      } else {
        setStatus("Qt WebChannel not available.");
      }

      button.addEventListener("click", () => {
        if (!backend) {
          setStatus("Backend not connected.");
          return;
        }
        backend.generate_stl(config.value);
      });

      previewButton.addEventListener("click", () => {
        if (!backend) {
          setStatus("Backend not connected.");
          return;
        }
        backend.open_preview();
      });

      loadButton.addEventListener("click", () => {
        if (!backend) {
          setStatus("Backend not connected.");
          return;
        }
        backend.pick_stl();
      });
    </script>
  </body>
</html>
